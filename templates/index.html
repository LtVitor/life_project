<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Rotina</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>Registro de Rotina</h1>
        <form action="/submit" method="POST" id="formRotina">
            <label>Acordou: <input type="time" name="acordou"></label>
            <label>Soneca 1 - Início: <input type="time" name="soneca1_inicio"></label>
            <label>Soneca 1 - Fim: <input type="time" name="soneca1_fim"></label>
            <label>Almoço: <input type="time" name="almoco"></label>
            <label>Soneca 2 - Início: <input type="time" name="soneca2_inicio"></label>
            <label>Soneca 2 - Fim: <input type="time" name="soneca2_fim"></label>
            <label>Soneca 3 - Início: <input type="time" name="soneca3_inicio"></label>
            <label>Soneca 3 - Fim: <input type="time" name="soneca3_fim"></label>
            <label>Jantar: <input type="time" name="jantar"></label>
            <label>Banho: <input type="time" name="banho"></label>
            <label>Mamar: <input type="time" name="mamar"></label>
            <label>Sono Noturno: <input type="time" name="sono_noturno"></label>

            <h2>Despertares</h2>
            <div id="despertares">
                <!-- Pares serão adicionados aqui via JS -->
            </div>
            <button type="button" onclick="adicionarDespertar()">Adicionar Despertar</button>

            <br><br>
            <button type="submit">Enviar</button>
        </form>
        <a href="/registros">Ver Registros</a>
    </div>

    <script>
        const form = document.getElementById('formRotina');
        const LS_KEY = 'formRotinaDados';

        // Restaura dados do localStorage
        window.onload = () => {
            const salvos = JSON.parse(localStorage.getItem(LS_KEY));
            if (salvos) {
                for (const [k, v] of Object.entries(salvos)) {
                    const el = form.elements[k];
                    if (el) el.value = v;
                }
            }
        }

        // Salva automaticamente ao digitar
        form.addEventListener('input', () => {
            const dados = {};
            for (let el of form.elements) {
                if (el.name && el.type !== 'submit') {
                    dados[el.name] = el.value;
                }
            }
            localStorage.setItem(LS_KEY, JSON.stringify(dados));
        });

        // Limpa localStorage ao enviar
        form.addEventListener('submit', () => {
            localStorage.removeItem(LS_KEY);
        });

        // Adiciona dinamicamente campos de despertar
        let contadorDespertares = 1;
        function adicionarDespertar() {
            if (contadorDespertares > 10) return;
            const container = document.getElementById('despertares');
            const div = document.createElement('div');
            div.innerHTML = `
                <label>Horário: <input type="time" name="despertares[${contadorDespertares}][horario]"></label>
                <label>Observação: <input type="text" name="despertares[${contadorDespertares}][observacao]"></label>
            `;
            container.appendChild(div);
            contadorDespertares++;
        }
    </script>
</body>
</html>
